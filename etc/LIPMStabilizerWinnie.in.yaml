Managed: false
StepByStep: false
IdleKeepState: true

StatesLibraries:
- "@MC_STATES_DEFAULT_RUNTIME_INSTALL_PREFIX@"
- "@MC_STATES_RUNTIME_INSTALL_PREFIX@"
- "@LIPM_WALKING_STATES_LIBRARIES@"
StatesFiles:
- "@MC_STATES_DEFAULT_RUNTIME_INSTALL_PREFIX@/data"
- "@MC_STATES_RUNTIME_INSTALL_PREFIX@/data"
- "@LIPM_WALKING_STATES_FILES@"
VerboseStateFactory: false

Plugins: [footsteps_planner_plugin,mc_joystick_plugin,MosquittoPlugin, Replay, XsensPlugin]

Replay:
  preload_logs:
    # Salutations
    - /home/arnaud/src/huiting/lipmstabilizerwinnie/xsens/Rocio02_fix_from_4_to_53.bin
    # Flying
    - /home/arnaud/src/huiting/lipmstabilizerwinnie/xsens/Rocio_dance/Rocio08_fix_cutSecondPart_from_34_to_120.bin
    # ListenToRobot
    - /home/arnaud/src/huiting/lipmstabilizerwinnie/xsens/Rocio_dance/Rocio04_fix_from_5_to_31.bin
    # PetiteDanse
    - /home/arnaud/src/huiting/lipmstabilizerwinnie/xsens/Rocio_dance/Rocio05_fix_from_3_to_132.bin
    # PetiteDanceEnervee
    - /home/arnaud/src/huiting/lipmstabilizerwinnie/xsens/Rocio_dance/Rocio06_fix_from_3_to_63.bin
    # Presence
    - /home/arnaud/src/huiting/lipmstabilizerwinnie/xsens/Rocio_dance/Rocio03_fix_from_8_to_28.bin
  with-inputs: false
  with-gui-inputs: false
  with-outputs: false
  with-datastore-config: /home/arnaud/src/huiting/lipmstabilizerwinnie/etc/datastore-to-replay.yaml
  pause: false

Xsens:
  liveMode: false
  hrp4:
    body:
      segment: "Pelvis"
      offset:
        translation: [0,0,0]
      # weight: 10
      # stiffness: 10
    torso:
      segment: "T8" # Sternum
      # weight: 10
      # stiffness: 10
    NECK_P_LINK:
      segment: "Head"
      offset:
        translation: [0,0,0]
        rotation: [0.0, 0.3, 0.0]
    R_SHOULDER_R_LINK:
      segment: "Right Shoulder"
    R_SHOULDER_Y_LINK:
      segment: "Right Upper Arm"
      offset:
        translation: [0,0,0]
        # rotation: [-1.57, 0, 0] #livemode
        # rotation: [0, 0, 0] #offlinemode: further adaptation
    R_ELBOW_P_LINK:
      segment: "Right Forearm"
      offset:
        translation: [0,0,0]
        rotation: [-1.57, 0, 0]
    r_wrist:
      segment: "Right Hand"
      offset:
        translation: [0,0,0]
        rotation: [-1.57, 0, 0]
    L_SHOULDER_R_LINK:
      segment: "Left Shoulder"
    L_SHOULDER_Y_LINK:
      segment: "Left Upper Arm"
      offset:
        translation: [0,0,0]
        # rotation: [1.57, 0, 0] #livemode
        # rotation: [0, 0, 0] #offlinemode: further adaptation
    L_ELBOW_P_LINK:
      segment: "Left Forearm"
      offset:
        translation: [0,0,0]
        rotation: [1.57, 0, 0]
    l_wrist:
      segment: "Left Hand"
      offset:
        translation: [0,0,0]
        rotation: [1.57, 0, 0]
    R_HIP_P_LINK:
      segment: "Right Upper Leg"
    R_KNEE_P_LINK:
      segment: "Right Lower Leg"
    r_ankle:
      segment: "Right Foot"
    L_HIP_P_LINK:
      segment: "Left Upper Leg"
    L_KNEE_P_LINK:
      segment: "Left Lower Leg"
    l_ankle:
      segment: "Left Foot"




# Additional robots to load
robots:
  ground:
    module: env/ground
# General constraints, always on
constraints:
- type: contact
- type: kinematics
  damper: [0.1, 0.01, 0.5]
- type: compoundJoint
# Collision constraint
collisions:
- type: collision
  useCommon: true
# Initial set of contacts
contacts: []

stabilizer:
  robot:
    hrp4:
      sole:
        half_length: 0.112
        half_width: 0.065
        friction: 0.7
      torso:
        pitch: 0.1

ismpc:
  Tc: 1.5
  Tp: 10
  delta: 0.05
  beta_zmp_vel: 0.001
  beta_dcm: 0
  beta_dcm_static: 0
  beta_step: 1e3
  beta_stab: 1e5
  beta_traj : 1e1
  allow_none_tail: true
  foosteps_kin_cstr: [0.6,0.25]
  footsteps_cstr_square: [0.6,0.25]
  ts_range: [0.7,2]
  tds_range: [0.2,1.5]
  tss_range: [0.5,1.5]
  double_support_ratio: 0.4
  ts: 1.3
  sliding_zmp_cstr_region: false
  use_stability_task: false
  safety_thresholds:
    beta_range: [1e-9,1e9]
    zmp_cstr_square_min: 0.01
    zmp_cstr_square_max: 1

footsteps_planner:
  Tp: 10
  delta: 0.1
  Ts_limit: [0.4,5]
  kinematics_cstr: [0.6,0.08]
  mean_speed: 0.1
  robot_height: 150
  max_rotation: 0.1

tasks:
  swingfoot_stiffness: 50
  swingfoot_weight: 1000
  momentum_task_weight: 100000
  posture:
    stiffness: 1.0
    weight: 10.0

walking_controller:
  auto_start:
    activate: false
    steps: 100
    speed: [0.25,0.0,0.1]
    ts: 1.1
    double_support_ratio: 0.25

  min_sg_suport_duration: 0.75
  min_dbl_suport_duration: 0.25
  foot_landing_offset: -3e-3
  max_step_duration: 2
  impact_threshold: 40
  footstep_height: 0.08
  wrench_filter_cutoff_T: 2
  gamma_filter_cutoff_T: 0.2
  safety_foot_roll_error: 0.1
  max_swing_foot_velocity: 1.6
  stability_error_threshold: 0.2

mpc:
  weights:
    jerk: 1.0
    vel: [10.0, 100.0]
    zmp: 1000.0

plans:
  hrp4:
    back_and_turn:
      com_height: 0.78
      contacts:
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [-0.32790156377014198, -0.026095169424085117, 0.0]
            rotation: [0.7157708469309063, -0.6983352308768426, 0.0, 0.6983352308768426, 0.7157708469309063, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: RightFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [-0.19823725562396853, 0.10299368874329029, 0.0]
            rotation: [0.7180449508008172, -0.6959967303295699, 0.0, 0.6959967303295699, 0.7180449508008172, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: LeftFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [-0.3435049516142538, -0.01106258095554128, 0.0]
            rotation: [0.7161718612849104, -0.697923967996305, 0.0, 0.697923967996305, 0.7161718612849104, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [-0.02378135951511725, 0.00002590628128492809, -0.0]
          surface: RightFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [-0.2497449376175162, 0.15352659870432029, 0.0]
            rotation: [0.7108495531389111, -0.7033440927470782, 0.0, 0.7033440927470782, 0.7108495531389111, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [-0.04756095314948534, 0.0004131120951167599, -0.0]
          surface: LeftFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [-0.41281543791575589, 0.05772760438988669, 0.0]
            rotation: [0.6986888421097378, -0.7154256788174115, 0.0, 0.7154256788174115, 0.6986888421097378, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [-0.047546884012368739, 0.001228310549098197, -0.0]
          surface: RightFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [-0.3123577486121172, 0.21793194583686888, 0.0]
            rotation: [0.6754795018878382, -0.7373787646314192, 0.0, 0.7373787646314192, 0.6754795018878382, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [-0.04748338472233087, 0.002746470717445637, -0.0]
          surface: LeftFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [-0.48168185855110548, 0.13352369425747299, 0.0]
            rotation: [0.6351829629691266, -0.7723617051315797, 0.0, 0.7723617051315797, 0.6351829629691266, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [-0.04726926954159945, 0.005275517329541218, -0.0]
          surface: RightFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [-0.3649029133105772, 0.2824221643074261, 0.0]
            rotation: [0.5666679689130678, -0.8239462440037813, 0.0, 0.8239462440037813, 0.5666679689130678, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [-0.0466434031335256, 0.00930633495067127, -0.0]
          surface: LeftFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [-0.5458921123455433, 0.22812300170954129, 0.0]
            rotation: [0.4662544805439889, -0.8846506425548197, 0.0, 0.8846506425548197, 0.4662544805439889, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [-0.04523221904848869, 0.01470582490172543, -0.0]
          surface: RightFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [-0.3976070364330102, 0.34471552038032957, 0.0]
            rotation: [0.33496141853904307, -0.9422318441287751, 0.0, 0.9422318441287751, 0.33496141853904307, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [-0.04266450576480897, 0.02102272280022866, -0.0]
          surface: LeftFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [-0.5864037221098558, 0.3427554952361493, 0.0]
            rotation: [0.19168779680139653, -0.9814559534474416, 0.0, 0.9814559534474416, 0.19168779680139653, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [-0.03907957899986257, 0.027110909820295068, -0.0]
          surface: RightFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [-0.41117754195727038, 0.4136259184394579, 0.0]
            rotation: [0.0658718465346031, -0.9978280913234112, 0.0, 0.9978280913234112, 0.0658718465346031, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [-0.017666109339939639, 0.015920499750697687, -0.0]
          surface: LeftFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [-0.5950628810887502, 0.42997272852286058, 0.0]
            rotation: [0.013890635800081652, -0.9999035204643844, 0.0, 0.9999035204643844, 0.013890635800081652, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [0.0, -0.0, 0.0]
          surface: RightFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [-0.41191711306953629, 0.4325169851534399, 0.0]
            rotation: [0.013890635800081652, -0.9999035204643844, 0.0, 0.9999035204643844, 0.013890635800081652, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [0.0, -0.0, 0.0]
          surface: LeftFootCenter
      double_support_duration: 0.2
      final_dsp_duration: 0.6
      init_dsp_duration: 0.6
      landing_duration: 0.15
      landing_pitch: 0.0
      single_support_duration: 0.8
      swing_height: 0.05
      takeoff_duration: 0.05
      takeoff_pitch: 0.0

    forward_and_left:
      com_height: 0.78
      contacts:
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [0.0358879558182822, 0.08779340970826372, 0.0]
            rotation: [0.9999896621531799, -0.0045470415403098449, 0.0, 0.0045470415403098449, 0.9999896621531799, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: LeftFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [0.03691595803041622, -0.09158171239694126, 0.0]
            rotation: [0.9999999999993025, 0.0000011811273687762365, 0.0, -0.0000011811273687762365, 0.9999999999993025, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: RightFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [0.11464627616984326, 0.12353944171802145, 0.0]
            rotation: [0.9823955345456993, 0.18681277714511397, 0.0, -0.18681277714511397, 0.9823955345456993, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: LeftFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [0.14886354698228544, -0.05639950338085914, 0.0]
            rotation: [0.9823955345456993, 0.18681277714511397, 0.0, -0.18681277714511397, 0.9823955345456993, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: RightFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [0.1737592710043086, 0.1915777313767702, 0.0]
            rotation: [0.9443575129987452, 0.32892079235406337, 0.0, -0.32892079235406337, 0.9443575129987452, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: LeftFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [0.23400553466902286, 0.018605961137832983, 0.0]
            rotation: [0.9443575129987452, 0.32892079235406337, 0.0, -0.32892079235406337, 0.9443575129987452, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: RightFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [0.22818561038123054, 0.26724355658209367, 0.0]
            rotation: [0.899693910719103, 0.4365213248112475, 0.0, -0.4365213248112475, 0.899693910719103, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: LeftFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [0.3081403576674396, 0.10245252535906752, 0.0]
            rotation: [0.899693910719103, 0.4365213248112475, 0.0, -0.4365213248112475, 0.899693910719103, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: RightFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [0.28481283887049116, 0.34496439963283478, 0.0]
            rotation: [0.8517789272076215, 0.5239013830531787, 0.0, -0.5239013830531787, 0.8517789272076215, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: LeftFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [0.3807724181717428, 0.18894964159540818, 0.0]
            rotation: [0.8517789272076215, 0.5239013830531787, 0.0, -0.5239013830531787, 0.8517789272076215, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: RightFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [0.34395397300704658, 0.4201469390995079, 0.0]
            rotation: [0.8036951461482363, 0.5950412692055611, 0.0, -0.5950412692055611, 0.8036951461482363, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: LeftFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [0.452943778544652, 0.2729393717871414, 0.0]
            rotation: [0.8036951461482363, 0.5950412692055611, 0.0, -0.5950412692055611, 0.8036951461482363, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: RightFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [0.4068263914500104, 0.4927641827880347, 0.0]
            rotation: [0.7557442569808054, 0.6548668704710372, 0.0, -0.6548668704710372, 0.7557442569808054, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: LeftFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [0.5267740598881167, 0.35433946526471057, 0.0]
            rotation: [0.7557442569808054, 0.6548668704710372, 0.0, -0.6548668704710372, 0.7557442569808054, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: RightFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [0.47293286674957366, 0.5618794644845921, 0.0]
            rotation: [0.708781487145075, 0.7054280994406276, 0.0, -0.7054280994406276, 0.708781487145075, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: LeftFootCenter
        - half_length: 0.112
          half_width: 0.065
          pose:
            translation: [0.6021415037932613, 0.43205660941483739, 0.0]
            rotation: [0.708781487145075, 0.7054280994406276, 0.0, -0.7054280994406276, 0.708781487145075, 0.0, 0.0, 0.0, 1.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: RightFootCenter
      double_support_duration: 0.2
      final_dsp_duration: 0.6
      init_dsp_duration: 0.6
      landing_duration: 0.15
      landing_pitch: 0.0
      single_support_duration: 0.8
      swing_height: 0.04
      takeoff_duration: 0.05
      takeoff_pitch: 0.0


    ashibumi: # stepping in place
      double_support_duration: 0.2
      single_support_duration: 0.8
      swing_height: 0.04
      contacts:
        - pose:
            translation: [0.035, -0.09, 0.0]
          surface: RightFootCenter
        - pose:
            translation: [0.035, 0.09, 0.0]
          surface: LeftFootCenter
        - pose:
            translation: [0.035, -0.09, 0.0]
          surface: RightFootCenter
        - pose:
            translation: [0.035, 0.09, 0.0]
          surface: LeftFootCenter
        - pose:
            translation: [0.035, -0.09, 0.0]
          surface: RightFootCenter
        - pose:
            translation: [0.035, 0.09, 0.0]
          surface: LeftFootCenter
        - pose:
            translation: [0.035, -0.09, 0.0]
          surface: RightFootCenter
        - pose:
            translation: [0.035, 0.09, 0.0]
          surface: LeftFootCenter
        - pose:
            translation: [0.035, -0.09, 0.0]
          surface: RightFootCenter
        - pose:
            translation: [0.035, 0.09, 0.0]
          surface: LeftFootCenter
        - pose:
            translation: [0.035, -0.09, 0.0]
          surface: RightFootCenter
        - pose:
            translation: [0.035, 0.09, 0.0]
          surface: LeftFootCenter
    comanoid_airbus_staircase: # https://youtu.be/vFCFKAunsYM
      init_dsp_duration: 0.6
      single_support_duration: 1.4
      double_support_duration: 0.2
      final_dsp_duration: 0.6
      swing_height: 0.24
      landing_duration: 0.1
      takeoff_duration: 0.42
      torso_pitch: 0.2
      contacts:
        - pose:
            translation: [-0.04, 0.09, 0.0]
          surface: LeftFootCenter
        - pose:
            translation: [-0.04, -0.09, 0.0]
          surface: RightFootCenter
          swing:
            takeoff_offset: [-0.03, 0.0, 0.0]
            takeoff_pitch: 0.6
        - pose:
            translation: [0.24, 0.09, 0.185]
          surface: LeftFootCenter
          swing:
            takeoff_offset: [-0.02, 0.0, 0.0]
        - pose:
            translation: [0.24, -0.09, 0.185]
          surface: RightFootCenter
          swing:
            takeoff_offset: [-0.03, 0.0, 0.0]
            takeoff_pitch: 0.6
        - pose:
            translation: [0.48, 0.09, 0.37]
          surface: LeftFootCenter
          swing:
            takeoff_offset: [-0.02, 0.0, 0.0]
        - pose:
            translation: [0.48, -0.09, 0.37]
          surface: RightFootCenter
          swing:
            takeoff_offset: [-0.03, 0.0, 0.0]
            takeoff_pitch: 0.6
        - pose:
            translation: [0.72, 0.09, 0.555]
          surface: LeftFootCenter
          swing:
            takeoff_offset: [-0.02, 0.0, 0.0]
        - pose:
            translation: [0.72, -0.09, 0.555]
          surface: RightFootCenter
          swing:
            takeoff_offset: [-0.03, 0.0, 0.0]
            takeoff_pitch: 0.6
        - pose:
            translation: [0.96, 0.09, 0.74]
          surface: LeftFootCenter
          swing:
            height: 0.2
            takeoff_offset: [-0.02, 0.0, 0.0]
        - pose:
            translation: [0.96, -0.09, 0.74]
          surface: RightFootCenter
          swing:
            height: 0.2
            takeoff_offset: [-0.03, 0.0, 0.0]
            takeoff_pitch: 0.6
        - pose:
            translation: [1.2, 0.09, 0.885]
          surface: LeftFootCenter
        - pose:
            translation: [1.2, -0.09, 0.885]
          surface: RightFootCenter
      mpc:
        weights:
          jerk: 1.0
          vel: [10.0, 300.0]
          zmp: 1000.0
    custom_backward:
      double_support_duration: 0.2
      single_support_duration: 0.8
      step_length: 0.15
      swing_height: 0.05
      contacts:
        - pose:
            translation: [0.0, -0.09, 0.0]
          surface: RightFootCenter
        - pose:
            translation: [0.0, 0.09, 0.0]
          surface: LeftFootCenter
    custom_forward:
      double_support_duration: 0.1
      single_support_duration: 0.7
      step_length: 0.2
      swing_height: 0.04
      contacts:
        - pose:
            translation: [0.0, -0.09, 0.0]
          surface: RightFootCenter
        - pose:
            translation: [0.0, 0.09, 0.0]
          surface: LeftFootCenter
    custom_lateral:
      double_support_duration: 0.2
      single_support_duration: 0.8
      step_length: 0.1
      swing_height: 0.04
      contacts:
        - pose:
            translation: [0.0, -0.09, 0.0]
          surface: RightFootCenter
        - pose:
            translation: [0.0, 0.09, 0.0]
          surface: LeftFootCenter
      mpc:
        weights:
          jerk: 1.0
          vel: [10.0, 300.0]
          zmp: 1000.0
    kajita_2010:
      double_support_duration: 0.2
      single_support_duration: 0.8
      swing_height: 0.04
      contacts:
        - pose:
            translation: [0.0, -0.09, 0.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: RightFootCenter
        - pose:
            translation: [0.0, 0.09, 0.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: LeftFootCenter
        - pose:
            translation: [0.2, -0.09, 0.0]
          ref_vel: [0.12, 0.0, 0.0]
          surface: RightFootCenter
        - pose:
            translation: [0.45, 0.09, 0.0]
          ref_vel: [0.25, 0.0, 0.0]
          surface: LeftFootCenter
        - pose:
            translation: [0.725, -0.09, 0.0]
          ref_vel: [0.25, 0.0, 0.0]
          surface: RightFootCenter
        - pose:
            translation: [0.975, 0.09, 0.0]
          ref_vel: [0.25, 0.0, 0.0]
          surface: LeftFootCenter
        - pose:
            translation: [1.25, -0.09, 0.0]
          ref_vel: [0.25, 0.0, 0.0]
          surface: RightFootCenter
        - pose:
            translation: [1.5, 0.09, 0.0]
          ref_vel: [0.25, 0.0, 0.0]
          surface: LeftFootCenter
        - pose:
            translation: [1.775, -0.09, 0.0]
          ref_vel: [0.12, 0.0, 0.0]
          surface: RightFootCenter
        - pose:
            translation: [1.975, 0.09, 0.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: LeftFootCenter
        - pose:
            translation: [1.975, -0.09, 0.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: RightFootCenter
    walk_backward_75cm:
      double_support_duration: 0.2
      single_support_duration: 0.8
      swing_height: 0.05
      contacts:
        - pose:
            translation: [0.0, -0.09, 0.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: RightFootCenter
        - pose:
            translation: [0.0, 0.09, 0.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: LeftFootCenter
        - pose:
            translation: [-0.15, -0.09, 0.0]
          ref_vel: [-0.075, 0.0, 0.0]
          surface: RightFootCenter
        - pose:
            translation: [-0.3, 0.09, 0.0]
          ref_vel: [-0.15, 0.0, 0.0]
          surface: LeftFootCenter
        - pose:
            translation: [-0.45, -0.09, 0.0]
          ref_vel: [-0.15, 0.0, 0.0]
          surface: RightFootCenter
        - pose:
            translation: [-0.6, 0.09, 0.0]
          ref_vel: [-0.075, 0.0, 0.0]
          surface: LeftFootCenter
        - pose:
            translation: [-0.75, -0.09, 0.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: RightFootCenter
        - pose:
            translation: [-0.75, 0.09, 0.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: LeftFootCenter
    walk_forward_100cm:
      double_support_duration: 0.1
      single_support_duration: 0.7
      swing_height: 0.04
      contacts:
        - pose:
            translation: [0.0, -0.09, 0.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: RightFootCenter
        - pose:
            translation: [0.0, 0.09, 0.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: LeftFootCenter
        - pose:
            translation: [0.2, -0.09, 0.0]
          ref_vel: [0.1, 0.0, 0.0]
          surface: RightFootCenter
        - pose:
            translation: [0.4, 0.09, 0.0]
          ref_vel: [0.2, 0.0, 0.0]
          surface: LeftFootCenter
        - pose:
            translation: [0.6, -0.09, 0.0]
          ref_vel: [0.2, 0.0, 0.0]
          surface: RightFootCenter
        - pose:
            translation: [0.8, 0.09, 0.0]
          ref_vel: [0.1, 0.0, 0.0]
          surface: LeftFootCenter
        - pose:
            translation: [1.0, -0.09, 0.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: RightFootCenter
        - pose:
            translation: [1.0, 0.09, 0.0]
          ref_vel: [0.0, 0.0, 0.0]
          surface: LeftFootCenter
    warmup:
      double_support_duration: 0.1
      single_support_duration: 0.7
      swing_height: 0.04
      contacts:
        - pose:
            translation: [0.035, -0.09, 0.0]
          surface: RightFootCenter
        - pose:
            translation: [0.035, 0.09, 0.0]
          surface: LeftFootCenter
        - pose:
            translation: [0.035, -0.09, 0.0]
          surface: RightFootCenter
        - pose:
            translation: [0.035, 0.09, 0.0]
          surface: LeftFootCenter


# Implement some additional text states
states:
  InterpolatePosture::Base:
    base: InterpolatePosture
    goBackToInitialPosture: false
    hrp4:
      posture_task:
        stiffness: 200
        activeJoints: [L_SHOULDER_P, L_SHOULDER_R, L_SHOULDER_Y, L_ELBOW_P, L_WRIST_P, L_WRIST_R, L_WRIST_Y,
                       R_SHOULDER_P, R_SHOULDER_R, R_SHOULDER_Y, R_ELBOW_P, R_WRIST_P, R_WRIST_R, R_WRIST_Y,
                       CHEST_P, NECK_P, NECK_Y]

  LookAt::Base:
    base: MetaTasks
    tasks:
      LookAt:
        activeJoints: [NECK_P, NECK_Y]

  LookAtRightHand:
    base: LookAt::Base
    tasks:
      LookAt:
        type: lookAtFrame
        frame: NECK_P_LINK
        frameVector: [1, 0, 0]
        target:
          robot: hrp4
          frame: r_wrist
        weight: 500
        stiffness: 10

  LookAtLeftHand:
    base: LookAt::Base
    tasks:
      LookAt:
        type: lookAtFrame
        frame: NECK_P_LINK
        frameVector: [1, 0, 0]
        target:
          robot: hrp4
          frame: l_wrist
        weight: 500
        stiffness: 10

  LookAtAudience:
    base: LookAt::Base
    tasks:
      LookAt:
        type: lookAt
        frame: NECK_P_LINK
        frameVector: [1, 0, 0]
        targetVector: [1, 0, 0]
        weight: 500
        stiffness: 10

  TouchHead:
    base: InterpolatePosture::Base
    hrp4:
      posture_sequence:
        - time: 2.0
          posture:
            # NECK_P: 0.8
            # NECK_Y: 1.2
            R_SHOULDER_R: -0.6
            R_SHOULDER_P: -2.5 #-2.0
            R_SHOULDER_Y: 1.6 #-3.1
            R_ELBOW_P: -2.1
            # L_SHOULDER_R: 2.15

  TouchHead_L:
    base: InterpolatePosture::Base
    hrp4:
      posture_sequence:
      - time: 2.0
        posture:
          # NECK_P: 0.8
          # NECK_Y: 1.2
          L_SHOULDER_R: 1.235
          L_SHOULDER_P: -1.9 #-2.0
          # L_SHOULDER_Y: 1.6 #-3.1
          L_ELBOW_P: -2.12
          # L_SHOULDER_R: 2.15

  RaiseRightHand_v2::Posture:
    base: InterpolatePosture::Base
    hrp4:
      scaleTime: 1.0
      posture_sequence:
        - time: 2.0
          posture:
            R_SHOULDER_P: -1.150
        - time: 2.0
          posture:
            R_SHOULDER_P: -1.150
            R_SHOULDER_R: -1.47

  RaiseRightHand_v2:
    base: MetaTasks
    tasks:
      LeftHandTrajectory:
        type: bspline_trajectory
        setupMode: false
        frame: r_gripper
        weight: 100
        stiffness: 50
        duration: 4
        dimWeight: [1,1,1, 1, 0.5, 0.5]
        displaySamples: 100
        target:
          translation: [0.4, -0.5, 1.1]
          rotation: [0, 0, 0]
        controlPoints: [[0.57, 0.5, 0.85]]
        # oriWaypoints: [[3.5, [-1.57,  0, 1.57]]]
        completion:
          timeElapsed: true

  RaiseRightHand:
    base: LookAtRightHand
    tasks:
      LeftHandTrajectory:
        type: bspline_trajectory
        setupMode: false
        frame: r_gripper
        weight: 100
        stiffness: 50
        duration: 4
        dimWeight: [1,1,1, 1, 0.5, 0.5]
        displaySamples: 100
        target:
          translation: [0.5, -0.3, 1.1]
          rotation: [0, 0, 0]
        controlPoints: [[0.57, 0.5, 0.85]]
        # oriWaypoints: [[3.5, [-1.57,  0, 1.57]]]
        completion:
          timeElapsed: true

  RaiseLeftHand:
    base: MetaTasks
    tasks:
      LeftHandTrajectory:
        type: bspline_trajectory
        setupMode: false
        frame: l_gripper
        weight: 100
        stiffness: 50
        duration: 4
        dimWeight: [1,1,1, 1, 0.5, 0.5]
        displaySamples: 100
        target:
          translation: [-0.5, 0.3, 0.5]
          rotation: [0, 0, 0]
        controlPoints: [[0.57, 0.5, 0.85]]
        # oriWaypoints: [[3.5, [-1.57,  0, 1.57]]]
        completion:
          timeElapsed: true

  RaiseLeftHand::Posture:
    base: InterpolatePosture::Base
    hrp4:
      scaleTime: 1.0
      posture_sequence:
        - time: 2.0
          posture:
            L_SHOULDER_P: -0.585
        - time: 2.0
          posture:
            L_SHOULDER_P: 0.382
            L_SHOULDER_R: 0.627
            L_SHOULDER_Y: 0.819
            L_ELBOW_P: -0.601

  RightHandBackground:
    base: LookAtRightHand
    tasks:
      LeftHandTrajectory:
        type: bspline_trajectory
        setupMode: false
        frame: r_gripper
        weight: 100
        stiffness: 50
        duration: 4
        dimWeight: [1,1, 1, 1, 0.5, 0.5]
        displaySamples: 100
        target:
          # Rotation expressed as RPY (in radian)
          # May also be expressed as quaternion or rotation matrix
          translation: [0.6, -0.3, 1.1]
          rotation: [0, 0, 0]
        controlPoints: [[0.0, 0.15, 0.85]]
        # oriWaypoints: [[3.5, [-1.57,  0, 1.57]]]
        completion:
          timeElapsed: true

  DrawCircleRightHand:
    base: MetaTasks
    tasks:
      LeftHandTrajectory:
        type: bspline_trajectory
        setupMode: false
        frame: r_gripper
        weight: 100
        stiffness: 50
        duration: 4
        dimWeight: [1,1,1, 1, 0.5, 0.5]
        displaySamples: 100
        target:
          translation: [0.7, 0.0, 0.8]
          rotation: [0, 0, 0]
        controlPoints: [[0.27, 0.4, 0.85]]
        # oriWaypoints: [[3.5, [-1.57,  0, 1.57]]]
        completion:
          timeElapsed: true

  DrawCircleRightHand::Posture:
    base: InterpolatePosture::Base
    hrp4:
      scaleTime: 1.0
      posture_sequence:
        - time: 2.0
          posture:
            R_SHOULDER_P: -0.971
            R_SHOULDER_R: -0.071
        - time: 2.0
          posture:
            R_SHOULDER_P: -1.551
            R_SHOULDER_R: -0.503
            R_SHOULDER_Y: 0.132

  DrawCircleLeftHand:
    base: MetaTasks
    tasks:
      LeftHandTrajectory:
        type: bspline_trajectory
        setupMode: false
        frame: l_gripper
        weight: 100
        stiffness: 50
        duration: 4
        dimWeight: [1,1,1, 1, 0.5, 0.5]
        displaySamples: 100
        target:
          translation: [0.7, 0.0, 0.5]
          rotation: [0, 0, 0]
        controlPoints: [[0.37, 0.2, 0.85]]
        # oriWaypoints: [[3.5, [-1.57,  0, 1.57]]]
        completion:
          timeElapsed: true

  DrawCircleLeftHand::Posture:
    base: InterpolatePosture::Base
    hrp4:
      scaleTime: 1.0
      posture_sequence:
        - time: 2.0
          posture:
            L_SHOULDER_P: -1.127
        - time: 2.0
          posture:
            L_SHOULDER_P: -1.127
            L_SHOULDER_R: 0.603
            L_SHOULDER_Y: -0.841

  PutDownRightShoulder:
    base: InterpolatePosture::Base
    hrp4:
      posture_sequence:
        - time: 2.0
          posture:
            R_SHOULDER_P: -0.167
            R_SHOULDER_R: -0.31
            R_SHOULDER_Y: 0.02
            R_ELBOW_P: -0.18
            R_WRIST_R: 0.08

  LeftHeadTilt:
    base: InterpolatePosture::Base
    hrp4:
      posture_sequence:
        - time: 2.0
          posture:
            NECK_P: 0.7
            # NECK_Y: 0.5
            # L_SHOULDER_R: 2.15

  RightHeadTilt:
    base: InterpolatePosture::Base
    hrp4:
      posture_sequence:
        - time: 2.0
          posture:
            NECK_P: 0.0
            # NECK_Y: -0.1
            # L_SHOULDER_R: 2.15

  Dance::LookRight:
    base: InterpolatePosture::Base
    hrp4:
      posture_sequence:
        - time: 2.0
          posture:
            NECK_Y: -1.0
        - time: 2.0
          posture:
            NECK_Y: -1.0
        - time: 2.0
          posture:
            NECK_Y: 0.0

  Dance::ConditionBaseMovement:
    base: AutonomousInteraction

  Salutations:
    base: InterpolatePosture::Base
    hrp4:
      duration: 30
      posture_sequence:
        - time: 5.0
          posture: {}
          comOffset: [0, 0, -0.2]
        - time: 5.0
          posture:
            R_SHOULDER_R: -0.662
            R_SHOULDER_Y: -0.52
            L_SHOULDER_R: 0.617
            L_SHOULDER_Y: 0.356
        - time: 5.0
          posture:
            R_SHOULDER_R: -0.206
            R_SHOULDER_Y: 0.156
            L_SHOULDER_R: 0.162
            L_SHOULDER_Y: 0.082
            R_ELBOW_P: -1.329
            L_ELBOW_P: -1.2679
        - time: 5.0
          posture:
            R_SHOULDER_R: -0.438
            L_SHOULDER_R: 0.405
            NECK_Y: 0.946
        - time: 5.0
          posture:
            NECK_Y: -1.02
        - time: 5.0
          posture:
            NECK_P: 0.607
        - time: 5.0
          posture:
            NECK_P: -0.607
        - time: 2.5
          posture:
            NECK_Y: -1.02
        - time: 2.5
          posture:
            NECK_P: 0.607
        - time: 2.5
          posture:
            NECK_P: -0.607
          # shake:
          #   NECK_P:
          #     period: 10 # [s]
          #     amplitude: 0.2 # rad
        - time: 5.0
          posture:
            R_SHOULDER_P: -1.375
            R_WRIST_Y: 1.284
            R_ELBOW_P: -1.415
        - time: 5.0
          posture:
            NECK_P: 0.82
          shake:
            NECK_P:
              period: 8 # [s]
              amplitude: 0.2 # rad
        - time: 5.0
          posture:
            R_SHOULDER_P: -0.227
            R_ELBOW_P: -0.586
        - time: 5.0
          posture:
            NECK_Y: 0.608
            NECK_P: -0.384
            L_SHOULDER_P: -1.412
            L_ELBOW_P: -1.688
          shake:
            L_SHOULDER_P:
              period: 10 # [s]
              amplitude: 0.2 # rad
        - time: 3.0
          posture:
            NECK_Y: -0.01
            NECK_P: -0.05
            L_SHOULDER_P: -0.21
            L_ELBOW_P: -1.037
            R_ELBOW_P: -1.115
            R_SHOULDER_P: -0.383
        - time: 5.0
          posture:
            L_SHOULDER_R: 0.703
            R_SHOULDER_R: -0.851
          shake:
            L_SHOULDER_R:
              period: 10 # [s]
              amplitude: 0.2 # rad
            R_SHOULDER_R:
              period: 10 # [s]
              amplitude: 0.2 # rad
        - time: 5.0
          posture:
            NECK_Y: -0.553
            NECK_P: -0.333
            R_SHOULDER_P: -1.267
            R_SHOULDER_R: -0.193
            R_SHOULDER_Y: 0.78
            R_ELBOW_P: -0.548
            L_SHOULDER_R: 0.176
          shake:
            NECK_P:
              period: 10 # [s]
              amplitude: 0.2 # rad

  PetiteDanse:
    base: InterpolatePosture::Base
    hrp4:
      duration: 120
      posture_sequence:
        - time: 5.0
          posture:
            NECK_Y: -0.483
            R_SHOULDER_P: -0.811
            R_ELBOW_P: -1.589
            L_SHOULDER_P: 0.623
            L_ELBOW_P: -1.589
        - time: 1.0
          posture:
            NECK_Y: 0
            R_SHOULDER_P: 0
            R_ELBOW_P: -1.589
            L_SHOULDER_P: 0
            L_ELBOW_P: -1.589
        - time: 240.0
          posture:
            NECK_Y: 0
            R_SHOULDER_P: 0
            R_ELBOW_P: -1.589
            L_SHOULDER_P: 0
            L_ELBOW_P: -1.589
          shake:
            R_SHOULDER_P:
              period: 4 # [s]
              amplitude: 0.5
              direction: -1
            L_SHOULDER_P:
              period: 4 # [s]
              amplitude: 0.5
              direction: 1
            NECK_Y:
              period: 4 # [s]
              amplitude: 0.8
          comOffset: [0, 0, -0.2]

  Walk::Base:
    base: Meta
    transitions:
      - [HalfSitting, OK, Walk, Auto]
    configs:
      Walk:
        plan: custom_forward
        useStopDistance: false
      HalfSitting:
        stiffness: 10.0
        eval: 0.2

  Walk::FollowMe:
    base: Walk::Base
    configs:
      Walk:
        plan: custom_forward

  Walk::FaceScene:
    base: Walk::Base
    transitions:
      - [HalfSitting, OK, Walk, Auto]
    configs:
      Walk:
        autoWalk: true
        plan: back_and_turn

  Walk::BackAndTurn:
    base: Walk::Base
    configs:
      Walk:
        autoWalk: true
        plan: back_and_turn

  Walk::ForwardAndLeft:
    base: Walk::Base
    configs:
      Walk:
        autoWalk: true
        plan: forward_and_left

  Dance::Demo::FSM:
    base: Meta
    ResetPostures: false
    # Interaction?
    # Salutations
    # Toucher
    # Marcher
    # Doute
    # Interaction
    # PetiteDance
    # PetiteDanceEnervee
    # Flying
    transitions:
      - [HalfSitting, Salutation, Salutations, Strict]
      - [HalfSitting, PetiteDanse, PetiteDanse, Strict]
      - [HalfSitting, ConditionBaseMovement, Dance::Seq4::ConditionBaseMovement::withPubSub, Strict]
      - [HalfSitting, FollowMe, Walk::FollowMe, Strict]
      - [HalfSitting, XsensSalutation, Dance::XsensRetargetting::Salutations, Strict]
      - [HalfSitting, XsensFlying, Dance::XsensRetargetting::Flying, Strict]
      - [HalfSitting, XsensListenToRobot, Dance::XsensRetargetting::ListenToRobot, Strict]
      - [HalfSitting, XsensDoute, Dance::XsensRetargetting::Doute, Strict]
      - [HalfSitting, XsensPetiteDance, Dance::XsensRetargetting::PetiteDance, Strict]
      - [HalfSitting, XsensPetiteDanceEnervee, Dance::XsensRetargetting::PetiteDanceEnervee, Strict]
      - [Salutations, OK, HalfSitting, Auto]
      - [PetiteDanse, OK, HalfSitting, Auto]
      - [Dance::Seq4::ConditionBaseMovement::withPubSub, OK, HalfSitting, Auto]
      - [Walk::FollowMe, OK, HalfSitting, Auto]
      - [Dance::XsensRetargetting::Salutations, OK, HalfSitting, Auto]
      - [Dance::XsensRetargetting::Flying, OK, HalfSitting, Auto]
      - [Dance::XsensRetargetting::ListenToRobot, OK, HalfSitting, Auto]
      - [Dance::XsensRetargetting::PetiteDance, OK, HalfSitting, Auto]
      - [Dance::XsensRetargetting::PetiteDanceEnervee, OK, HalfSitting, Auto]
      - [Dance::XsensRetargetting::Doute, OK, HalfSitting, Auto]
    configs:
      HalfSitting:
        stiffness: 10.0
        eval: 0.1

  HalfSitting::Final:
    base: HalfSitting
    stiffness: 10.0
    eval: 0.1

  Demo::WaitForStart:
    base: Pause

  Dance::Demo::FSM::FullSequence:
    base: Meta
    ResetPostures: false
    # Interaction?
    # Salutations
    # Toucher
    # Marcher
    # Doute
    # Interaction
    # PetiteDance
    # PetiteDanceEnervee
    # Flying
    transitions:
      - [Demo::WaitForStart, OK, Dance::XsensRetargetting::Salutations, Strict]
      - [Dance::XsensRetargetting::Salutations, OK, Dance::XsensRetargetting::Salutations::HalfSitting, Auto]
      - [Dance::XsensRetargetting::Salutations::HalfSitting, OK, Dance::XsensRetargetting::ListenToRobot, Strict]
      - [Dance::XsensRetargetting::ListenToRobot, OK, Dance::XsensRetargetting::ListenToRobot::HalfSitting, Auto]
      - [Dance::XsensRetargetting::ListenToRobot::HalfSitting, OK, Walk::FollowMe, Strict]
      - [Walk::FollowMe, OK, Dance::LookRight, Auto] ## XXX duplicated halfsitting here
      - [Dance::LookRight, OK, Walk::BackAndTurn, Strict]
      - [Walk::BackAndTurn, OK, Dance::XsensRetargetting::Doute, Strict]
      - [Dance::XsensRetargetting::Doute, OK, Dance::XsensRetargetting::Doute::HalfSitting, Auto]
      - [Dance::XsensRetargetting::Doute::HalfSitting, OK, Walk::ForwardAndLeft, Strict] # XXX duplicated halfsitting here
      - [Walk::ForwardAndLeft, OK, Dance::Seq4::ConditionBaseMovement::withPubSub, Strict]
      - [Dance::Seq4::ConditionBaseMovement::withPubSub, OK, Dance::XsensRetargetting::PetiteDance, Auto]
      - [Dance::XsensRetargetting::PetiteDance, OK, Dance::XsensRetargetting::PetiteDanceEnervee, Strict]
      - [Dance::XsensRetargetting::PetiteDanceEnervee, OK, Dance::XsensRetargetting::Doute2, Strict]
      - [Dance::XsensRetargetting::Doute2, OK, Dance::XsensRetargetting::FinDance, Auto]
      - [Dance::XsensRetargetting::FinDance, OK, Dance::XsensRetargetting::FinDance2, Auto]
      - [Dance::XsensRetargetting::FinDance2, OK, Walk::FaceScene, Strict]
      - [Walk::FaceScene, OK, Dance::PrepareFlying, Strict]
      - [Dance::PrepareFlying, OK, Dance::XsensRetargetting::Flying, Strict]
      - [Dance::XsensRetargetting::Flying, OK, HalfSitting::Final, Auto]
        # HalfSitting after
    configs:
      HalfSitting:
        stiffness: 10.0
        eval: 0.1

  Dance::Demo::StabilizedFSM:
    base: Parallel
    states: [Stabilizer::Standing, Dance::Demo::FSM]

  Dance::Seq4::ConditionBaseMovement:
    base: Meta
    ResetPostures: false
    StepByStep: false
    transitions:
      - [Dance::ConditionBaseMovement, Seq0, TouchHead, Auto]
      - [Dance::ConditionBaseMovement, Seq1, DrawCircleRightHand::Posture, Auto]
      - [Dance::ConditionBaseMovement, Seq2, RaiseRightHand_v2::Posture, Auto]
      - [Dance::ConditionBaseMovement, Seq3, TouchHead_L, Auto]
      - [Dance::ConditionBaseMovement, Seq4, RaiseLeftHand::Posture, Auto]
      - [Dance::ConditionBaseMovement, Seq5, DrawCircleLeftHand::Posture, Auto]
      - [Dance::ConditionBaseMovement, Seq6, LeftHeadTilt, Auto]
      - [Dance::ConditionBaseMovement, Seq7, RightHeadTilt, Auto]
      - [TouchHead, OK, HalfSitting, Auto]
      - [DrawCircleRightHand::Posture, OK, HalfSitting, Auto]
      - [RaiseRightHand_v2::Posture, OK, HalfSitting, Auto]
      - [TouchHead_L, OK, HalfSitting, Auto]
      - [RaiseLeftHand::Posture, OK, HalfSitting, Auto]
      - [DrawCircleLeftHand::Posture, OK, HalfSitting, Auto]
      - [LeftHeadTilt, OK, HalfSitting, Auto]
      - [RightHeadTilt, OK, HalfSitting, Auto]
      - [HalfSitting, OK, Dance::ConditionBaseMovement, Auto]

  Dance::Seq4::ConditionBaseMovement::withPubSub:
    base: Parallel
    states: [RosSubscriber, LookAtAudience, Dance::Seq4::ConditionBaseMovement]

  Demo::LIPMWalking::WalkInternal:
    base: Meta
    transitions:
    - [LIPMWalking::Standing, DoubleSupport, LIPMWalking::DoubleSupport]
    - [LIPMWalking::DoubleSupport, SingleSupport, LIPMWalking::SingleSupport]
    - [LIPMWalking::DoubleSupport, Standing, LIPMWalking::Standing]
    - [LIPMWalking::SingleSupport, DoubleSupport, LIPMWalking::DoubleSupport]
    configs:
      LIPMWalking::Standing:
        autoplay: false
        autoplay_plans: [external]

  LIPMWalking::StabilizedWalkInternal:
    base: Parallel
    states: [LIPMWalking::RunStabilizer, Demo::LIPMWalking::WalkInternal]

  Demo::LIPMWalking::WalkFSM:
    base: Meta
    transitions:
      - [LIPMWalking::Initial, Standing, LIPMWalking::StabilizedWalkInternal, Auto]
    configs:
      LIPMWalking::Initial:
        autoplay: true

  Demo::LIPMWalking::Dance:
    base: Parallel
    states: [Demo::LIPMWalking::WalkFSM, Dance::Demo::FSM]

  Demo::LIPMWalking::Dance::FullSequence:
    base: Parallel
    states: [Demo::LIPMWalking::WalkFSM, Dance::Demo::FSM::FullSequence]

transitions:
  - [Pause, LIPMWalking, Demo::LIPMWalking::Dance, Strict]
  - [Pause, LIPMWalkingFullSequence, Demo::LIPMWalking::Dance::FullSequence, Strict]
  #- [Pause, ISMPC, Dance::Demo::FSM, Strict]

init: Pause

ObserverPipelines:
  name: "LIPMWalkingObserverPipeline"
  gui: true
  observers:
    - type: Encoder
      #- type: Attitude
      #  required: true
      #  update: true
    - type: KinematicInertial
      update: true
      config:
        cutoff: 0.02
        anchorFrame:
          maxAnchorFrameDiscontinuity: 0.02
    - type: BodySensor
      update: false
      config:
        bodySensor: FloatingBase
