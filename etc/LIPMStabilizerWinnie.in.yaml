Managed: false
StepByStep: false
IdleKeepState: true

StatesLibraries:
- "@MC_STATES_DEFAULT_RUNTIME_INSTALL_PREFIX@"
- "@MC_STATES_RUNTIME_INSTALL_PREFIX@"
StatesFiles:
- "@MC_STATES_DEFAULT_RUNTIME_INSTALL_PREFIX@/data"
- "@MC_STATES_RUNTIME_INSTALL_PREFIX@/data"
VerboseStateFactory: false

# Additional robots to load
robots:
  ground:
    module: env/ground
# General constraints, always on
constraints:
- type: contact
- type: kinematics
  damper: [0.1, 0.01, 0.5]
- type: compoundJoint
# Collision constraint
collisions:
- type: collision
  useMinimal: true
  collisions:
    - body1: r_wrist
      body2: torso
      iDist: 0.1
      sDist: 0.08
    - body1: R_WRIST_P_LINK
      body2: torso
      iDist: 0.1
      sDist: 0.08
    - body1: R_WRIST_Y_LINK
      body2: torso
      iDist: 0.1
      sDist: 0.08
    - body1: R_ELBOW_P_LINK
      body2: torso
      iDist: 0.1
      sDist: 0.08
    - body1: r_wrist
      body2: body
      iDist: 0.1
      sDist: 0.05
    - body1: R_WRIST_P_LINK
      body2: body
      iDist: 0.1
      sDist: 0.05
    - body1: R_WRIST_Y_LINK
      body2: body
      iDist: 0.1
      sDist: 0.05
    - body1: R_ELBOW_P_LINK
      body2: body
      iDist: 0.1
      sDist: 0.05
    - body1: r_wrist
      body2: NECK_P_LINK
      iDist: 0.1
      sDist: 0.05
    - body1: R_WRIST_P_LINK
      body2: NECK_P_LINK
      iDist: 0.1
      sDist: 0.05
    - body1: R_WRIST_Y_LINK
      body2: NECK_P_LINK
      iDist: 0.1
      sDist: 0.05
    - body1: R_ELBOW_P_LINK
      body2: NECK_P_LINK
      iDist: 0.1
      sDist: 0.05

# Initial set of contacts
contacts: []

# Implement some additional text states
states:
  ###
  # Simple foot lifting
  # Tasks to handle the free foot
  # - Lift up phase: surface transform moving above the current position
  # - Put down phase: admittance tasks looking for a positive force above a threshold
  ###
  LIPMStabilizer::LiftRightFoot: #usable;but robot flows in the air
    base: MetaTasks
    tasks:
      LiftFootTask:
        type: surfaceTransform
        stiffness: 10
        weight: 500
        surface: "RightFoot"
        moveWorld:
          translation: [0,0,0.1]
        completion:
          OR:
          - eval: 0.01
          - AND:
            - timeout: 3
            - speed: 0.005

  LIPMStabilizer::LiftLeftFoot: #usable;but robot flows in the air
    base: LIPMStabilizer::LiftRightFoot
    tasks:
      LiftFootTask:
        surface: LeftFoot

  LIPMStabilizer::PutRightFoot: #usable;but robot flows in the air
    base: MetaTasks
    tasks:
      PutFootAdmittance:
        type: admittance
        surface: RightFoot
        stiffness: [10, 10, 10, 10, 10, 3]
        damping: [6.3, 6.3, 6.3, 6.3, 6.3, 300]
        admittance: [0,0,0,0,0,0.001]
        maxVel:
          linear: [0.2, 0.2, 0.5]
          angular: [0.2, 0.2, 0.2]
        wrench:
         force: [0, 0, 20]
         couple: [0, 0, 0]
        moveWorld:
          translation: [0, 0, -0.1]
        overwriteRPY:
          roll: 0
          pitch: 0
        completion:
          wrench:
            force: [.nan, .nan, 20]
            couple: [.nan, .nan, .nan]

  LIPMStabilizer::PutLeftFoot: #usable;but robot flows in the air
    base: LIPMStabilizer::PutRightFoot
    tasks:
      PutFootAdmittance:
        surface: LeftFoot

  LIPMStabilizer::Stabilized::LiftRightFoot: #usable
    base: Parallel
    states: [Stabilizer::LeftSupport, LIPMStabilizer::LiftRightFoot]

  LIPMStabilizer::Stabilized::LiftLeftFoot: #usable
    base: Parallel
    states: [Stabilizer::RightSupport, LIPMStabilizer::LiftLeftFoot]

  LIPMStabilizer::Stabilized::PutRightFoot: #usable
    base: Parallel
    states: [Stabilizer::LeftSupport, LIPMStabilizer::PutRightFoot]

  LIPMStabilizer::Stabilized::PutLeftFoot: #usable
    base: Parallel
    states: [Stabilizer::RightSupport, LIPMStabilizer::PutLeftFoot]

  LIPMStabilizer::Stabilized::StayLeft: #usable
    base: Stabilizer::GoLeft
    completion: {}

  LIPMStabilizer::Stabilized::StayRight: #usable
    base: Stabilizer::GoRight
    completion: {}

  LIPMStabilizer::StandingFSM::LiftRightFoot:
    base: Meta
    transitions:
      - [Stabilizer::GoLeft, OK, LIPMStabilizer::Stabilized::LiftRightFoot]
      - [LIPMStabilizer::Stabilized::LiftRightFoot, OK, LIPMStabilizer::Stabilized::PutRightFoot]
      - [LIPMStabilizer::Stabilized::PutRightFoot, OK, LIPMStabilizer::Stabilized::StayLeft, Auto]

  LIPMStabilizer::StandingFSM::LiftLeftFoot:
    base: Meta
    transitions:
      - [Stabilizer::GoRight, OK, LIPMStabilizer::Stabilized::LiftLeftFoot]
      - [LIPMStabilizer::Stabilized::LiftLeftFoot, OK, LIPMStabilizer::Stabilized::PutLeftFoot]
      - [LIPMStabilizer::Stabilized::PutLeftFoot, OK, LIPMStabilizer::Stabilized::StayRight, Auto]

  LIPMStabilizer::StandingFSM::LiftRightFootManual:
    base: LIPMStabilizer::StandingFSM::LiftRightFoot
    StepByStep: true

  LIPMStabilizer::StandingFSM::LiftLeftFootManual:
    base: LIPMStabilizer::StandingFSM::LiftLeftFoot
    StepByStep: true

  LIPMStabilizer::StandingFSM::AlternateFeetLifting:
    base: Meta
    transitions:
      - [LIPMStabilizer::StandingFSM::LiftRightFoot, OK, LIPMStabilizer::StandingFSM::LiftLeftFoot]
      - [LIPMStabilizer::StandingFSM::LiftLeftFoot, OK, Stabilizer::GoCenter]

  LIPMStabilizer::StandingFSM::AlternateFeetLifting1:
    base: LIPMStabilizer::StandingFSM::AlternateFeetLifting

  LIPMStabilizer::StandingFSM::AlternateFeetLifting2:
    base: LIPMStabilizer::StandingFSM::AlternateFeetLifting

  LIPMStabilizer::StandingFSM::AlternateFeetLiftingManual:
    base: Meta
    StepByStep: true
    transitions:
      - [Stabilizer::GoCenter, OK, LIPMStabilizer::StandingFSM::LiftRightFootManual]
      - [LIPMStabilizer::StandingFSM::LiftRightFootManual, OK, LIPMStabilizer::StandingFSM::LiftLeftFootManual]
      - [LIPMStabilizer::StandingFSM::LiftLeftFootManual, OK, Stabilizer::GoCenter]

  ###
  # Simple forward walking FSM
  ###
  LIPMStabilizer::RightFootTrajectory: #usable;but robot flows in the air
    base: MetaTasks
    tasks:
      SwingFootTrajectory:
        type: exact_cubic_trajectory
        surface: RightFoot
        stiffness: 10000.0
        duration: 5.0
        weight: 100
        displaySamples: 20
        completion:
          OR:
            - timeElapsed: true
            - AND:
              - timeout: 2.5
              - wrench: [.nan, .nan, .nan, .nan, .nan, 20]
        targetSurface:
          surface: RightFoot
          # Aim 5mm above ground as the FSM does not have early-impact detection
          translation: [0.1, 0.0, 0.005]
          rotation: [0,0,0]
          # control points in target surface frame
          controlPoints:
            - [1, [0.01, 0.0, 0.01]]

  LIPMStabilizer::LeftFootTrajectory: #usable;but robot flows in the air
    base: LIPMStabilizer::RightFootTrajectory
    tasks:
      SwingFootTrajectory:
        surface: LeftFoot
        targetSurface:
          surface: LeftFoot
          translation: [0.1, 0.0, 0.005]
          rotation: [0,0,0]
          # control points in target surface frame
          controlPoints:
            - [1., [0.01, 0.0, 0.01]]


  LIPMStabilizer::Stabilized::LeftFootTrajectory: #usable
    base: Parallel
    states: [Stabilizer::RightSupport, LIPMStabilizer::LeftFootTrajectory]

  LIPMStabilizer::Stabilized::RightFootTrajectory: #usable
    base: Parallel
    states: [Stabilizer::LeftSupport, LIPMStabilizer::RightFootTrajectory]

  LIPMStabilizer::WalkingFSM::RightStep:
    base: Meta
    transitions:
    - [Stabilizer::GoLeft, OK, LIPMStabilizer::Stabilized::RightFootTrajectory, Auto]

  LIPMStabilizer::WalkingFSM::LeftStep:
    base: LIPMStabilizer::WalkingFSM::RightStep
    transitions:
    - [Stabilizer::GoRight, OK, LIPMStabilizer::Stabilized::LeftFootTrajectory, Auto]


  LIPMStabilizer::WalkingFSM::StepForward:
    base: Meta
    transitions:
    - [LIPMStabilizer::WalkingFSM::LeftStep, OK, LIPMStabilizer::WalkingFSM::RightStep, Auto]
    - [LIPMStabilizer::WalkingFSM::RightStep, OK, Stabilizer::GoCenter, Auto]

  LIPMStabilizer::WalkingFSM::StepForward1:
    base: LIPMStabilizer::WalkingFSM::StepForward

  LIPMStabilizer::WalkingFSM::StepForward2:
    base: LIPMStabilizer::WalkingFSM::StepForward

  LIPMStabilizer::WalkingFSM::StepForward3:
    base: LIPMStabilizer::WalkingFSM::StepForward


  ###
  # FSM to walk backwards
  ###
  LIPMStabilizer::RightFootBackwardTrajectory: #usable;but robot flows in the air
    base: LIPMStabilizer::RightFootTrajectory
    tasks:
      SwingFootTrajectory:
        targetSurface:
          surface: RightFoot
          translation: [-0.1, 0.0, 0.005]
          rotation: [0, 0, 0]
          # control points in target surface frame
          controlPoints:
            - [1, [-0.01, 0.0, 0.01]]

  LIPMStabilizer::LeftFootBackwardTrajectory: #usable;but robot flows in the air
    base: LIPMStabilizer::RightFootBackwardTrajectory
    tasks:
      SwingFootTrajectory:
        surface: LeftFoot
        targetSurface:
          surface: LeftFoot
          translation: [-0.1, 0.0, 0.005]
          rotation: [0,0,0]
          # control points in target surface frame
          controlPoints:
            - [1., [-0.01, 0.0, 0.01]]

  LIPMStabilizer::Stabilized::LeftFootBackwardTrajectory: #usable
    base: Parallel
    states: [Stabilizer::RightSupport, LIPMStabilizer::LeftFootBackwardTrajectory]

  LIPMStabilizer::Stabilized::RightFootBackwardTrajectory: #usable
    base: Parallel
    states: [Stabilizer::LeftSupport, LIPMStabilizer::RightFootBackwardTrajectory]

  LIPMStabilizer::WalkingFSM::RightBackwardStep:
    base: Meta
    transitions:
    - [Stabilizer::GoLeft, OK, LIPMStabilizer::Stabilized::RightFootBackwardTrajectory, Auto]

  LIPMStabilizer::WalkingFSM::LeftBackwardStep:
    base: LIPMStabilizer::WalkingFSM::RightStep
    transitions:
    - [Stabilizer::GoRight, OK, LIPMStabilizer::Stabilized::LeftFootBackwardTrajectory, Auto]

  LIPMStabilizer::WalkingFSM::StepBackward:
    base: Meta
    transitions:
    - [LIPMStabilizer::WalkingFSM::LeftBackwardStep, OK, LIPMStabilizer::WalkingFSM::RightBackwardStep, Auto]
    - [LIPMStabilizer::WalkingFSM::RightBackwardStep, OK, Stabilizer::GoCenter, Auto]

  LIPMStabilizer::WalkingFSM::StepBackward1:
    base: LIPMStabilizer::WalkingFSM::StepBackward

  LookAtRightHand:
    base: MetaTasks
    tasks:
      LookAt:
        type: lookAtFrame
        frame: NECK_P_LINK
        frameVector: [1, 0, 0]
        target:
          robot: hrp4
          frame: r_wrist
        weight: 500
        stiffness: 10
  
  LookAtLeftHand:
    base: MetaTasks
    tasks:
      LookAt:
        type: lookAtFrame
        frame: NECK_P_LINK
        frameVector: [1, 0, 0]
        target:
          robot: hrp4
          frame: l_wrist
        weight: 500
        stiffness: 10
  
  TouchHead:
    base: LookAtRightHand
    tasks:
      RightHandToTheHead:
        type: posture
        stiffness: 1.0
        weight: 100.0
        target:
          NECK_P: [0.8]
          NECK_Y: [1.2]
          R_SHOULDER_R: [-0.6]
          R_SHOULDER_P: [-2.5] #-2.0
          R_SHOULDER_Y: [1.6] #-3.1
          R_ELBOW_P: [-2.1]
          # L_SHOULDER_R: [2.15]
        completion:
          OR:
            - timeout: 8.0
            - AND:
              - eval: 0.01
              - speed: 0.01

  TouchHead_L:
    base: LookAtLeftHand
    tasks:
      RightHandToTheHead:
        type: posture
        stiffness: 1.0
        weight: 100.0
        target:
          NECK_P: [0.8]
          NECK_Y: [1.2]
          L_SHOULDER_R: [1.235]
          # L_SHOULDER_P: [-2.5] #-2.0
          # L_SHOULDER_Y: [1.6] #-3.1
          L_ELBOW_P: [-1.29]
          # L_SHOULDER_R: [2.15]
        completion:
          OR:
            - timeout: 8.0
            - AND:
              - eval: 0.01
              - speed: 0.01

  RaiseRightHand_v2:
    base: LookAtRightHand
    tasks:
      LeftHandTrajectory:
        type: bspline_trajectory
        setupMode: false
        surface: r_gripper
        weight: 100
        stiffness: 50
        duration: 4
        dimWeight: [1,1,1, 1, 0.5, 0.5]
        displaySamples: 100
        target:
          translation: [0.4, -0.5, 1.1]
          rotation: [0, 0, 0]
        controlPoints: [[0.57, 0.5, 0.85]]
        # oriWaypoints: [[3.5, [-1.57,  0, 1.57]]]
        completion:
          timeElapsed: true

  RaiseRightHand:
    base: LookAtRightHand
    tasks:
      LeftHandTrajectory:
        type: bspline_trajectory
        setupMode: false
        surface: r_gripper
        weight: 100
        stiffness: 50
        duration: 4
        dimWeight: [1,1,1, 1, 0.5, 0.5]
        displaySamples: 100
        target:
          translation: [0.5, -0.3, 1.1]
          rotation: [0, 0, 0]
        controlPoints: [[0.57, 0.5, 0.85]]
        # oriWaypoints: [[3.5, [-1.57,  0, 1.57]]]
        completion:
          timeElapsed: true

  RaiseLeftHand:
    base: LookAtLeftHand
    tasks:
      LeftHandTrajectory:
        type: bspline_trajectory
        setupMode: false
        surface: l_gripper
        weight: 100
        stiffness: 50
        duration: 4
        dimWeight: [1,1,1, 1, 0.5, 0.5]
        displaySamples: 100
        target:
          translation: [-0.5, 0.3, 0.5]
          rotation: [0, 0, 0]
        controlPoints: [[0.57, 0.5, 0.85]]
        # oriWaypoints: [[3.5, [-1.57,  0, 1.57]]]
        completion:
          timeElapsed: true

  RightHandBackground:
    base: LookAtRightHand
    tasks:
      LeftHandTrajectory:
        type: bspline_trajectory
        setupMode: false
        surface: r_gripper
        weight: 100
        stiffness: 50
        duration: 4
        dimWeight: [1,1, 1, 1, 0.5, 0.5]
        displaySamples: 100
        target:
          # Rotation expressed as RPY (in radian)
          # May also be expressed as quaternion or rotation matrix
          translation: [0.6, -0.3, 1.1]
          rotation: [0, 0, 0]
        controlPoints: [[0.0, 0.15, 0.85]]
        # oriWaypoints: [[3.5, [-1.57,  0, 1.57]]]
        completion:
          timeElapsed: true

  DrawCircleRightHand:
    base: LookAtRightHand
    tasks:
      LeftHandTrajectory:
        type: bspline_trajectory
        setupMode: false
        surface: r_gripper
        weight: 100
        stiffness: 50
        duration: 4
        dimWeight: [1,1,1, 1, 0.5, 0.5]
        displaySamples: 100
        target:
          translation: [0.7, 0.0, 0.8]
          rotation: [0, 0, 0]
        controlPoints: [[0.27, 0.4, 0.85]]
        # oriWaypoints: [[3.5, [-1.57,  0, 1.57]]]
        completion:
          timeElapsed: true

  DrawCircleLeftHand:
    base: LookAtLeftHand
    tasks:
      LeftHandTrajectory:
        type: bspline_trajectory
        setupMode: false
        surface: l_gripper
        weight: 100
        stiffness: 50
        duration: 4
        dimWeight: [1,1,1, 1, 0.5, 0.5]
        displaySamples: 100
        target:
          translation: [0.7, 0.0, -0.8]
          rotation: [0, 0, 0]
        controlPoints: [[0.27, 0.4, 0.85]]
        # oriWaypoints: [[3.5, [-1.57,  0, 1.57]]]
        completion:
          timeElapsed: true

  PutDownRightShoulder:
    base: MetaTasks
    tasks:
      RightHandToTheHead:
        type: posture
        stiffness: 1.0
        weight: 100.0
        target:
          R_SHOULDER_P: [-0.167]
          R_SHOULDER_R: [-0.31]
          R_SHOULDER_Y: [0.02]
          R_ELBOW_P: [-0.18]
          R_WRIST_R: [0.08]
        completion:
          OR:
            - eval: 0.1
            - AND:
              - timeout: 1.0
              - speed: 0.1

  LeftHeadTilt:
    base: MetaTasks
    tasks:
      LeftHeadTiltPosture:
        type: posture
        stiffness: 1.0
        weight: 100.0
        target:
          NECK_P: [0.7]
          NECK_Y: [0.5]
          # L_SHOULDER_R: [2.15]
        completion:
          OR:
            - timeout: 8.0
            - AND:
              - eval: 0.01
              - speed: 0.01

  RightHeadTilt:
    base: MetaTasks
    tasks:
      RightHeadTiltPosture:
        type: posture
        stiffness: 1.0
        weight: 100.0
        target:
          NECK_P: [-0.7]
          NECK_Y: [-0.5]
          # L_SHOULDER_R: [2.15]
        completion:
          OR:
            - timeout: 8.0
            - AND:
              - eval: 0.01
              - speed: 0.01


  TouchHeadStabilized:
    base: Parallel
    states: [Stabilizer::Standing, TouchHead]

  RaiseRightHandStabilized:
    base: Parallel
    states: [Stabilizer::Standing, RaiseRightHand]

  RightHandBackgroundStabilized:
    base: Parallel
    states: [Stabilizer::Standing, RightHandBackground]

  DrawCircleRightHandStabilized:
    base: Parallel
    states: [Stabilizer::Standing, DrawCircleRightHand]

  PutDownRightShoulderStabilized:
    base: Parallel
    states: [Stabilizer::Standing, PutDownRightShoulder]

  Dance::Seq1::Walk:
    base: Meta
    transitions:
      - [LIPMStabilizer::StandingFSM::AlternateFeetLifting, OK, LIPMStabilizer::WalkingFSM::StepForward, Auto]
      - [LIPMStabilizer::WalkingFSM::StepForward, OK, LIPMStabilizer::WalkingFSM::StepForward1, Auto]
      - [LIPMStabilizer::WalkingFSM::StepForward1, OK, LIPMStabilizer::WalkingFSM::StepForward2, Auto]
      - [LIPMStabilizer::WalkingFSM::StepForward2, OK, LIPMStabilizer::WalkingFSM::StepBackward1, Auto]
      - [LIPMStabilizer::WalkingFSM::StepBackward1, OK, LIPMStabilizer::StandingFSM::AlternateFeetLifting1, Auto]
      - [LIPMStabilizer::StandingFSM::AlternateFeetLifting1, OK, LIPMStabilizer::WalkingFSM::StepForward3, Auto]
      - [LIPMStabilizer::WalkingFSM::StepForward3, OK, LIPMStabilizer::StandingFSM::AlternateFeetLifting2, Auto]

  Dance::Seq3::LookForApples:
    base: Meta
    transitions:
      - [LIPMStabilizer::StandingFSM::AlternateFeetLifting,   OK, LIPMStabilizer::WalkingFSM::StepForward, Auto]
      - [LIPMStabilizer::WalkingFSM::StepForward,             OK, TouchHeadStabilized, Auto]
      - [TouchHeadStabilized,                                 OK, LIPMStabilizer::WalkingFSM::StepForward1, Auto]
      - [LIPMStabilizer::WalkingFSM::StepForward1,            OK, LIPMStabilizer::WalkingFSM::StepForward2, Auto]
      - [LIPMStabilizer::WalkingFSM::StepForward2,            OK, RaiseRightHandStabilized, Auto]
      - [RaiseRightHandStabilized,                            OK, LIPMStabilizer::WalkingFSM::StepBackward1, Auto]
      - [LIPMStabilizer::WalkingFSM::StepBackward1,           OK, LIPMStabilizer::StandingFSM::AlternateFeetLifting1, Auto]
      - [LIPMStabilizer::StandingFSM::AlternateFeetLifting1,  OK, RightHandBackgroundStabilized, Auto]
      - [RightHandBackgroundStabilized,                       OK, DrawCircleRightHandStabilized, Auto]
      - [DrawCircleRightHandStabilized,                       OK, PutDownRightShoulderStabilized, Auto]
      - [PutDownRightShoulderStabilized,                      OK, LIPMStabilizer::WalkingFSM::StepForward3, Auto]
      - [LIPMStabilizer::WalkingFSM::StepForward3,            OK, LIPMStabilizer::StandingFSM::AlternateFeetLifting2, Auto]

  Dance::Seq4::ConditionBaseMovement:
    base: Meta
    transitions:
      - [Dance::Standing, OK, Dance::ConditionBaseMovement, Auto]
      - [Dance::ConditionBaseMovement, Seq0, Dance::RightHandInteractNormal, Auto]
      - [Dance::ConditionBaseMovement, Seq1, Dance::RightHandInteractCloseToCore, Auto]
      - [Dance::ConditionBaseMovement, Seq2, Dance::RightHandInteractFarFromCore, Auto]
      - [Dance::ConditionBaseMovement, Seq3, Dance::LeftHandInteractNormal, Auto]
      - [Dance::ConditionBaseMovement, Seq4, Dance::LeftHandInteractCloseToCore, Auto]
      - [Dance::ConditionBaseMovement, Seq5, Dance::LeftHandInteractFarFromCore, Auto]
      - [Dance::ConditionBaseMovement, Seq6, Dance::LeftHeadTilt, Auto]
      - [Dance::ConditionBaseMovement, Seq7, Dance::RightHeadTilt, Auto]
      - [Dance::RightHandInteractNormal, OK, Dance::Standing, Auto]
      - [Dance::RightHandInteractCloseToCore, OK, Dance::Standing, Auto]
      - [Dance::RightHandInteractFarFromCore, OK, Dance::Standing, Auto]
      - [Dance::LeftHandInteractNormal, OK, Dance::Standing, Auto]
      - [Dance::LeftHandInteractCloseToCore, OK, Dance::Standing, Auto]
      - [Dance::LeftHandInteractFarFromCore, OK, Dance::Standing, Auto]
      - [Dance::LeftHeadTilt, OK, Dance::Standing, Auto]
      - [Dance::RightHeadTilt, OK, Dance::Standing, Auto]

  Dance::Standing:
    base: Parallel
    states: [HalfSitting, Stabilizer::Standing]

  Dance::ConditionBaseMovement:
    base: AutonomousInteraction
    robot: hrp4
    stiffness: 200
    weight: 1000
    offset:
      translation: [0.0, 0.0, 0.0]

  Dance::Seq0::TESTrosSubscriber:
    base: LIPMStabilizer::WalkingFSM::StepForward

  Dance::Seq1::TESTrosSubscriber:
    base: LIPMStabilizer::StandingFSM::AlternateFeetLifting

  Dance::Seq2::TESTrosSubscriber:
    base: LIPMStabilizer::WalkingFSM::StepBackward

  Dance::Seq3::TESTrosSubscriber:
    base: Dance::Standing

  Dance::RightHandInteractNormal:
    base: Parallel
    states: [Stabilizer::Standing, TouchHead]

  Dance::RightHandInteractCloseToCore:
    base: Parallel
    states: [Stabilizer::Standing, DrawCircleRightHand]

  Dance::RightHandInteractFarFromCore:
    base: Parallel
    states: [Stabilizer::Standing, RaiseRightHand_v2]

  Dance::LeftHandInteractNormal:
    base: Parallel
    states: [Stabilizer::Standing, TouchHead_L]

  Dance::LeftHandInteractCloseToCore:
    base: Parallel
    states: [Stabilizer::Standing, RaiseLeftHand]

  Dance::LeftHandInteractFarFromCore:
    base: Parallel
    states: [Stabilizer::Standing, DrawCircleLeftHand]

  Dance::LeftHeadTilt:
    base: Parallel
    states: [Stabilizer::Standing, LeftHeadTilt]

  Dance::RightHeadTilt:
    base: Parallel
    states: [Stabilizer::Standing, RightHeadTilt]

  Dance::Seq4::ConditionBaseMovement::withPubSub:
    base: Parallel
    states: [RosSubscriber, Stabilizer::Standing, Dance::Seq4::ConditionBaseMovement] #[FAIL] to run these two in parallel: cannot do movements when the ros is receiving data at the same time.
  

transitions: 
- [Dance::Seq4::ConditionBaseMovement::withPubSub, OK, Dance::Seq4::ConditionBaseMovement::withPubSub, Strict]
##demo danse seq on real HRP4
# - [Dance::Standing, DanceSeq1, Dance::Seq1::Walk, Strict] # this line help to show up the bottom control on moveing forward to this state in the simulation interface
# - [Dance::Standing, DanceSeq2, Dance::Seq3::LookForApples, Strict]
# - [Dance::Seq1::Walk, OK, Dance::Standing, Auto]
# - [Dance::Seq3::LookForApples, OK, Dance::Standing, Auto]

##condition base movements (prepare to sync with HPE algo)
# - [Dance::Standing, DanceSeq1, Dance::ConditionBaseMovement, Strict]
# - [Dance::ConditionBaseMovement, Seq0, Dance::Seq0::TESTrosSubscriber, Auto]
# - [Dance::ConditionBaseMovement, Seq1, Dance::Seq1::TESTrosSubscriber, Auto]
# - [Dance::ConditionBaseMovement, Seq2, Dance::Seq2::TESTrosSubscriber, Auto]
# - [Dance::ConditionBaseMovement, Seq3, Dance::Seq3::TESTrosSubscriber, Auto]
# - [Dance::Seq0::TESTrosSubscriber, OK, Dance::Standing, Auto]
# - [Dance::Seq1::TESTrosSubscriber, OK, Dance::Standing, Auto]
# - [Dance::Seq2::TESTrosSubscriber, OK, Dance::Standing, Auto]
# - [Dance::Seq3::TESTrosSubscriber, OK, Dance::Standing, Auto]

##condition base movements (syncing with HPE algo)
# - [Dance::Standing, DanceSeq1, Dance::ConditionBaseMovement, Strict]
# - [Dance::Standing, DanceSeq1, RosSubscriber, Strict]
# - [RosSubscriber, DanceSeq2, Dance::ConditionBaseMovement, Strict]

- [Dance::Standing, OK, RosSubscriber, Auto]
- [RosSubscriber, OK, Dance::ConditionBaseMovement, Auto]
- [Dance::ConditionBaseMovement, Seq0, Dance::RightHandInteractNormal, Auto]
- [Dance::ConditionBaseMovement, Seq1, Dance::RightHandInteractCloseToCore, Auto]
- [Dance::ConditionBaseMovement, Seq2, Dance::RightHandInteractFarFromCore, Auto]
- [Dance::ConditionBaseMovement, Seq3, Dance::LeftHandInteractNormal, Auto]
- [Dance::ConditionBaseMovement, Seq4, Dance::LeftHandInteractCloseToCore, Auto]
- [Dance::ConditionBaseMovement, Seq5, Dance::LeftHandInteractFarFromCore, Auto]
- [Dance::ConditionBaseMovement, Seq6, Dance::LeftHeadTilt, Auto]
- [Dance::ConditionBaseMovement, Seq7, Dance::RightHeadTilt, Auto]
- [Dance::RightHandInteractNormal, OK, RosSubscriber, Auto]
- [Dance::RightHandInteractCloseToCore, OK, RosSubscriber, Auto]
- [Dance::RightHandInteractFarFromCore, OK, RosSubscriber, Auto]
- [Dance::LeftHandInteractNormal, OK, RosSubscriber, Auto]
- [Dance::LeftHandInteractCloseToCore, OK, RosSubscriber, Auto]
- [Dance::LeftHandInteractFarFromCore, OK, RosSubscriber, Auto]
- [Dance::LeftHeadTilt, OK, RosSubscriber, Auto]
- [Dance::RightHeadTilt, OK, RosSubscriber, Auto]
# # - [Dance::Standing, DanceSeq1, Dance::RightHandInteractNormal, Strict]
# # - [Dance::Standing, DanceSeq2, Dance::RightHandInteractCloseToCore, Strict]
# # - [Dance::Standing, DanceSeq3, Dance::RightHandInteractFarFromCore, Strict]
# # - [Dance::Standing, DanceSeq4, Dance::LeftHandInteractNormal, Strict]
# # - [Dance::Standing, DanceSeq5, Dance::LeftHandInteractCloseToCore, Strict]
# # - [Dance::Standing, DanceSeq6, Dance::LeftHandInteractFarFromCore, Strict]
# # - [Dance::Standing, DanceSeq7, Dance::LeftHeadTilt, Strict]
# # - [Dance::Standing, DanceSeq8, Dance::RightHeadTilt, Strict]

#[TODO]: still remain a problem where the standing movements can't finish in a proper way. The final solution might be using "parallel" method.

##condition base movements (syncing with HPE algo + ros-subs/pubs running in back ground)
# - [Dance::Standing, OK, Dance::Seq4::ConditionBaseMovement::withPubSub, Auto]


init: Dance::Seq4::ConditionBaseMovement::withPubSub

ObserverPipelines:
- name: "MainPipeline"
  observers:
    - type: Encoder
    - type: Attitude
    - type: KinematicInertial
